{% extends 'partials/base.html.twig' %}

{% set id = uri.query('id') ?? null %}
{% set embed = uri.query('embed') ?? false %}
{% set body_classes = 'bg-gray-50' %}

{% block render_block %}
  {% if id and embed %}
    {% include 'partials/order-iframe.html.twig' with { order_id: id } %}
  {% else %}
    {{ parent() }}
  {% endif %}
{% endblock %}

{% set links = [
  {
    'url': '/',
    'title': "BSCOPE.LOGIN_HEADER_HOME"|t
  },
  {
    'url': url('profile'),
    'title': 'BSCOPE.BREADCRUMB_PROFILE'|t
  },
  {
    'title': 'METRICALO.MY_ORDERS'|t
  }
] %}

{% if id %}
  {% set links = [
    {
      'url': '/',
      'title': "BSCOPE.LOGIN_HEADER_HOME"|t
    },
    {
      'url': url('profile'),
      'title': 'BSCOPE.BREADCRUMB_PROFILE'|t
    },
    {
      'url': url('profile/orders'),
      'title': 'METRICALO.MY_ORDERS'|t
    },
    {
      'title': 'METRICALO.MY_ORDER'|t
    }
  ] %}
{% endif %}

{% block content %}


  {% include 'partials/no-hero-header.html.twig' with {
    'title': page.header.title,
    'links': links
  } %}
<div class="max-w-6xl mx-auto rounded-lg bg-white shadow-2xl shadow-gray-300 border border-gray-200 p-12 orders-table-wrapper">
  {% if id %}
    <iframe src="{{ page.url }}?id={{ id }}&embed=true" frameborder="0" width="100%" height="800"></iframe>
  {% else %}
    {% set invoices = website_manager_api.getInvoices(grav.user.data.customer_id) %}

    <table class="table orders-table slide-up animate" cellpadding="0" cellspacing="0">
      <thead>
      <tr>
        <th>{{ 'METRICALO.ORDER_ID'|t }}</th>
        <th>{{ 'METRICALO.PRODUCT'|t }}</th>
        <th>{{ 'METRICALO.TYPE'|t }}</th>
        <th>{{ 'METRICALO.TOTAL'|t }}</th>
        <th>{{ 'METRICALO.STATUS'|t }}</th>
        <th>{{ 'METRICALO.CREATED_AT'|t }}</th>
        <th></th>
      </tr>
      </thead>
      <tbody>
      {% for invoice in invoices.data %}
        <tr>
          <td>{{ invoice.id }}</td>
          <td>{{ invoice.product.name }}</td>
          <td>{{ invoice.type }}</td>
          <td>{{ invoice.total_incl_vat }} {{ invoice.currency }}</td>
          <td>{{ invoice.status }}</td>
          <td>{{ invoice.created_at|date('d/m/Y H:i:s') }}</td>
          <td><a class="btn" href="{{ url('profile/orders') }}?id={{ invoice.id }}">{{ icon('eye', 'h-4 w-4 mr-2')|raw }}{{ 'METRICALO.VIEW_INVOICE'|t }}</a></td>
        </tr>
      {% endfor %}
      </tbody>
    </table>
  {% endif %}
</div>
{% endblock %}

